name: Frontend CI

on:
  push:
    branches: [ main ]
  # Run on pull requests that target `main` only.
  pull_request:
    branches: [ main ]

jobs:
  lint-typecheck-secrets:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: '18'

      - name: Install dependencies (FinanceRemix)
        working-directory: FinanceFrontEnd/FinanceRemix
        run: |
          npm ci

      - name: Install dependencies (FinanceFunds)
        working-directory: FinanceFrontEnd/FinanceFunds
        run: |
          npm ci

      - name: Focused no-console lint (FinanceRemix)
        working-directory: FinanceFrontEnd/FinanceRemix
        run: |
          # Enforce only the no-console rule to avoid blocking on unrelated lint errors
          npx eslint . --rule "no-console: 2" --ext .ts,.tsx,.js,.jsx

      - name: Typecheck (FinanceRemix)
        working-directory: FinanceFrontEnd/FinanceRemix
        run: |
          npm run typecheck

      - name: Focused no-console lint (FinanceFunds)
        working-directory: FinanceFrontEnd/FinanceFunds
        run: |
          npx eslint . --rule "no-console: 2" --ext .ts,.tsx,.js,.jsx

      - name: Run gitleaks secret scan (selected folders)
        # install platform binary and run against specific folders to skip FinanceFront
        run: |
          GITLEAKS_VERSION="v8.21.0"
          curl -sL "https://github.com/zricethezav/gitleaks/releases/download/${GITLEAKS_VERSION}/gitleaks_${GITLEAKS_VERSION#v}_linux_x64.tar.gz" -o gitleaks.tar.gz
          tar -xzf gitleaks.tar.gz
          # Scan backend and modern frontends only (skip FinanceFrontEnd/FinanceFront)
          ./gitleaks detect --source FinanceBackEnd --report-path gitleaks-backend.json || true
          ./gitleaks detect --source FinanceFrontEnd/FinanceRemix --report-path gitleaks-remix.json || true
          ./gitleaks detect --source FinanceFrontEnd/FinanceFunds --report-path gitleaks-funds.json || true
        shell: bash
